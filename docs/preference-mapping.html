<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Preference Mapping |  “The R Opus v2”</title>
  <meta name="description" content="<p>This bookdown is a complete update of Hildegarde Heymann’s “R Opus”
documentation, originally compiled in 2015. It gives helpful details and
walkthroughs on common multivariate analyses in <code>R</code> for sensory-evaluation data.</p>" />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Preference Mapping |  “The R Opus v2”" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/img/r-opus-cover.jpg" />
  <meta property="og:description" content="<p>This bookdown is a complete update of Hildegarde Heymann’s “R Opus”
documentation, originally compiled in 2015. It gives helpful details and
walkthroughs on common multivariate analyses in <code>R</code> for sensory-evaluation data.</p>" />
  <meta name="github-repo" content="jlahne/r-opus-v2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Preference Mapping |  “The R Opus v2”" />
  
  <meta name="twitter:description" content="<p>This bookdown is a complete update of Hildegarde Heymann’s “R Opus”
documentation, originally compiled in 2015. It gives helpful details and
walkthroughs on common multivariate analyses in <code>R</code> for sensory-evaluation data.</p>" />
  <meta name="twitter:image" content="/img/r-opus-cover.jpg" />

<meta name="author" content="Jacob Lahne" />


<meta name="date" content="2024-01-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="correspondence-analysis-ca.html"/>
<link rel="next" href="multiple-factorial-analysis-mfa.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The R Opus v2</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i>Usage</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#r-setup"><i class="fa fa-check"></i><code>R</code> Setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-this-is-not"><i class="fa fa-check"></i>What this is not</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-me"><i class="fa fa-check"></i>About me</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#session-info"><i class="fa fa-check"></i>Session Info</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html"><i class="fa fa-check"></i><b>1</b> Data import and set up</a>
<ul>
<li class="chapter" data-level="1.1" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#exploring-our-data"><i class="fa fa-check"></i><b>1.1</b> Exploring our data</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#the-descriptive-data"><i class="fa fa-check"></i><b>1.1.1</b> The descriptive data</a></li>
<li class="chapter" data-level="1.1.2" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#consumer-data"><i class="fa fa-check"></i><b>1.1.2</b> Consumer data</a></li>
<li class="chapter" data-level="1.1.3" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#the-other-data-frames"><i class="fa fa-check"></i><b>1.1.3</b> The other data frames</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#wranglingtidying-data"><i class="fa fa-check"></i><b>1.2</b> Wrangling/tidying data</a></li>
<li class="chapter" data-level="1.3" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#wrap-up-and-summary"><i class="fa fa-check"></i><b>1.3</b> Wrap up and summary</a></li>
<li class="chapter" data-level="1.4" data-path="data-import-and-set-up.html"><a href="data-import-and-set-up.html#packages-used-in-this-chapter"><i class="fa fa-check"></i><b>1.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i><b>2</b> Analysis of Variance</a>
<ul>
<li class="chapter" data-level="2.1" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html#univariate-analysis-with-the-linear-model"><i class="fa fa-check"></i><b>2.1</b> Univariate analysis with the linear model</a></li>
<li class="chapter" data-level="2.2" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html#pseudo-mixed-anova"><i class="fa fa-check"></i><b>2.2</b> Pseudo-mixed ANOVA</a></li>
<li class="chapter" data-level="2.3" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html#mean-comparison-post-hoc-testing"><i class="fa fa-check"></i><b>2.3</b> Mean comparison (post-hoc testing)</a></li>
<li class="chapter" data-level="2.4" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html#bonus-bayesian-approaches-to-anova"><i class="fa fa-check"></i><b>2.4</b> BONUS: Bayesian approaches to ANOVA</a></li>
<li class="chapter" data-level="2.5" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html#packages-used-in-this-chapter-1"><i class="fa fa-check"></i><b>2.5</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dealing-with-missing-data.html"><a href="dealing-with-missing-data.html"><i class="fa fa-check"></i><b>3</b> Dealing with missing data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dealing-with-missing-data.html"><a href="dealing-with-missing-data.html#exploring-missing-data"><i class="fa fa-check"></i><b>3.1</b> Exploring missing data</a></li>
<li class="chapter" data-level="3.2" data-path="dealing-with-missing-data.html"><a href="dealing-with-missing-data.html#imputing-missing-data"><i class="fa fa-check"></i><b>3.2</b> Imputing missing data</a></li>
<li class="chapter" data-level="3.3" data-path="dealing-with-missing-data.html"><a href="dealing-with-missing-data.html#alternative-approaches-to-imputation"><i class="fa fa-check"></i><b>3.3</b> Alternative approaches to imputation</a></li>
<li class="chapter" data-level="3.4" data-path="dealing-with-missing-data.html"><a href="dealing-with-missing-data.html#packages-used-in-this-chapter-2"><i class="fa fa-check"></i><b>3.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manova-multivariate-analysis-of-variance.html"><a href="manova-multivariate-analysis-of-variance.html"><i class="fa fa-check"></i><b>4</b> MANOVA (Multivariate Analysis of Variance)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="manova-multivariate-analysis-of-variance.html"><a href="manova-multivariate-analysis-of-variance.html#running-manova"><i class="fa fa-check"></i><b>4.1</b> Running MANOVA</a></li>
<li class="chapter" data-level="4.2" data-path="manova-multivariate-analysis-of-variance.html"><a href="manova-multivariate-analysis-of-variance.html#what-does-manova-test"><i class="fa fa-check"></i><b>4.2</b> What does MANOVA test?</a></li>
<li class="chapter" data-level="4.3" data-path="manova-multivariate-analysis-of-variance.html"><a href="manova-multivariate-analysis-of-variance.html#bonus-hierarchical-bayes-instead-of-manova"><i class="fa fa-check"></i><b>4.3</b> BONUS: Hierarchical Bayes instead of MANOVA</a></li>
<li class="chapter" data-level="4.4" data-path="manova-multivariate-analysis-of-variance.html"><a href="manova-multivariate-analysis-of-variance.html#packages-used-in-this-chapter-3"><i class="fa fa-check"></i><b>4.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html"><i class="fa fa-check"></i><b>5</b> Canonical Variate Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#what-is-cva"><i class="fa fa-check"></i><b>5.1</b> What is CVA?</a></li>
<li class="chapter" data-level="5.2" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#application-of-cva"><i class="fa fa-check"></i><b>5.2</b> Application of CVA</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#basic-visualization-of-cva"><i class="fa fa-check"></i><b>5.2.1</b> Basic visualization of CVA</a></li>
<li class="chapter" data-level="5.2.2" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#an-aside-on-exporting-r-plots"><i class="fa fa-check"></i><b>5.2.2</b> An aside on exporting R plots</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#plotting-uncertainty-in-cva"><i class="fa fa-check"></i><b>5.3</b> Plotting uncertainty in CVA</a></li>
<li class="chapter" data-level="5.4" data-path="canonical-variate-analysis.html"><a href="canonical-variate-analysis.html#packages-used-in-this-chapter-4"><i class="fa fa-check"></i><b>5.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html"><i class="fa fa-check"></i><b>6</b> Principal Components Analysis (PCA)</a>
<ul>
<li class="chapter" data-level="6.1" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#what-does-pca-do"><i class="fa fa-check"></i><b>6.1</b> What does PCA do?</a></li>
<li class="chapter" data-level="6.2" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#lets-do-pca"><i class="fa fa-check"></i><b>6.2</b> Let’s do PCA!</a></li>
<li class="chapter" data-level="6.3" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#in-depth-interpretation"><i class="fa fa-check"></i><b>6.3</b> In-depth interpretation</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#correlations-or-squared-loadings-or-contributions"><i class="fa fa-check"></i><b>6.3.1</b> Correlations or (squared) loadings or contributions</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#pca-with-resampling-for-confidence-intervals"><i class="fa fa-check"></i><b>6.4</b> PCA with resampling for confidence intervals</a></li>
<li class="chapter" data-level="6.5" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#comparison-of-products-with-pca"><i class="fa fa-check"></i><b>6.5</b> Comparison of products with PCA</a></li>
<li class="chapter" data-level="6.6" data-path="principal-components-analysis-pca.html"><a href="principal-components-analysis-pca.html#packages-used-in-this-chapter-5"><i class="fa fa-check"></i><b>6.6</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>7</b> Cluster analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#hierarchical-clustering-on-distances"><i class="fa fa-check"></i><b>7.1</b> Hierarchical clustering on distances</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#wards-method"><i class="fa fa-check"></i><b>7.1.1</b> Ward’s Method</a></li>
<li class="chapter" data-level="7.1.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#single-linkage"><i class="fa fa-check"></i><b>7.1.2</b> Single linkage</a></li>
<li class="chapter" data-level="7.1.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#complete-linkage"><i class="fa fa-check"></i><b>7.1.3</b> Complete Linkage</a></li>
<li class="chapter" data-level="7.1.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#average-linkage"><i class="fa fa-check"></i><b>7.1.4</b> Average Linkage</a></li>
<li class="chapter" data-level="7.1.5" data-path="cluster-analysis.html"><a href="cluster-analysis.html#comparing-methods"><i class="fa fa-check"></i><b>7.1.5</b> Comparing methods</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#using-cluster-ids"><i class="fa fa-check"></i><b>7.2</b> Using cluster IDs</a></li>
<li class="chapter" data-level="7.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#k-means-clustering"><i class="fa fa-check"></i><b>7.3</b> K-means clustering</a></li>
<li class="chapter" data-level="7.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#packages-used-in-this-chapter-6"><i class="fa fa-check"></i><b>7.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html"><i class="fa fa-check"></i><b>8</b> Multidimensional Scaling (MDS)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html#metric-vs-non-metric"><i class="fa fa-check"></i><b>8.1</b> Metric vs non-metric</a></li>
<li class="chapter" data-level="8.2" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html#metric-mds"><i class="fa fa-check"></i><b>8.2</b> Metric MDS</a></li>
<li class="chapter" data-level="8.3" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html#non-metric-mds"><i class="fa fa-check"></i><b>8.3</b> Non-metric MDS</a></li>
<li class="chapter" data-level="8.4" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html#wrap-up"><i class="fa fa-check"></i><b>8.4</b> Wrap up</a></li>
<li class="chapter" data-level="8.5" data-path="multidimensional-scaling-mds.html"><a href="multidimensional-scaling-mds.html#packages-used-in-this-chapter-7"><i class="fa fa-check"></i><b>8.5</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="distatis.html"><a href="distatis.html"><i class="fa fa-check"></i><b>9</b> DISTATIS</a>
<ul>
<li class="chapter" data-level="9.1" data-path="distatis.html"><a href="distatis.html#the-dataset-sorting-wines-by-color"><i class="fa fa-check"></i><b>9.1</b> The dataset: sorting wines by color</a></li>
<li class="chapter" data-level="9.2" data-path="distatis.html"><a href="distatis.html#distatis-demonstrated"><i class="fa fa-check"></i><b>9.2</b> DISTATIS demonstrated</a></li>
<li class="chapter" data-level="9.3" data-path="distatis.html"><a href="distatis.html#comparison-to-mds"><i class="fa fa-check"></i><b>9.3</b> Comparison to MDS</a></li>
<li class="chapter" data-level="9.4" data-path="distatis.html"><a href="distatis.html#packages-used-in-this-chapter-8"><i class="fa fa-check"></i><b>9.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="correspondence-analysis-ca.html"><a href="correspondence-analysis-ca.html"><i class="fa fa-check"></i><b>10</b> Correspondence Analysis (CA)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="correspondence-analysis-ca.html"><a href="correspondence-analysis-ca.html#packages-used-in-this-chapter-9"><i class="fa fa-check"></i><b>10.1</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="preference-mapping.html"><a href="preference-mapping.html"><i class="fa fa-check"></i><b>11</b> Preference Mapping</a>
<ul>
<li class="chapter" data-level="11.1" data-path="preference-mapping.html"><a href="preference-mapping.html#data"><i class="fa fa-check"></i><b>11.1</b> Data</a></li>
<li class="chapter" data-level="11.2" data-path="preference-mapping.html"><a href="preference-mapping.html#internal-preference-mapping"><i class="fa fa-check"></i><b>11.2</b> Internal preference mapping</a></li>
<li class="chapter" data-level="11.3" data-path="preference-mapping.html"><a href="preference-mapping.html#external-preference-mapping"><i class="fa fa-check"></i><b>11.3</b> External preference mapping</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="preference-mapping.html"><a href="preference-mapping.html#partial-least-squares-regression"><i class="fa fa-check"></i><b>11.3.1</b> Partial Least Squares Regression</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="preference-mapping.html"><a href="preference-mapping.html#other-approaches"><i class="fa fa-check"></i><b>11.4</b> Other approaches</a></li>
<li class="chapter" data-level="11.5" data-path="preference-mapping.html"><a href="preference-mapping.html#principal-components-regression"><i class="fa fa-check"></i><b>11.5</b> Principal Components Regression</a></li>
<li class="chapter" data-level="11.6" data-path="preference-mapping.html"><a href="preference-mapping.html#packages-used-in-this-chapter-10"><i class="fa fa-check"></i><b>11.6</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="multiple-factorial-analysis-mfa.html"><a href="multiple-factorial-analysis-mfa.html"><i class="fa fa-check"></i><b>12</b> Multiple Factor(ial) Analysis (MFA)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="multiple-factorial-analysis-mfa.html"><a href="multiple-factorial-analysis-mfa.html#mfa-vs-pca"><i class="fa fa-check"></i><b>12.1</b> MFA vs PCA</a></li>
<li class="chapter" data-level="12.2" data-path="multiple-factorial-analysis-mfa.html"><a href="multiple-factorial-analysis-mfa.html#mfa-with-different-measurements"><i class="fa fa-check"></i><b>12.2</b> MFA with different measurements</a></li>
<li class="chapter" data-level="12.3" data-path="multiple-factorial-analysis-mfa.html"><a href="multiple-factorial-analysis-mfa.html#wrapping-up"><i class="fa fa-check"></i><b>12.3</b> Wrapping up</a></li>
<li class="chapter" data-level="12.4" data-path="multiple-factorial-analysis-mfa.html"><a href="multiple-factorial-analysis-mfa.html#packages-used-in-this-chapter-11"><i class="fa fa-check"></i><b>12.4</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="generalized-procrustes-analysis.html"><a href="generalized-procrustes-analysis.html"><i class="fa fa-check"></i><b>13</b> Generalized Procrustes Analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="generalized-procrustes-analysis.html"><a href="generalized-procrustes-analysis.html#packages-used-in-this-chapter-12"><i class="fa fa-check"></i><b>13.1</b> Packages used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="wrapping-up-1.html"><a href="wrapping-up-1.html"><i class="fa fa-check"></i><b>14</b> Wrapping up</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><p><img src="img/r-opus-cover.jpg" style="width:6in" /><br />
“The R Opus v2”</p></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preference-mapping" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Preference Mapping<a href="preference-mapping.html#preference-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In general, preference mapping is the name for a broad set of methods that attempts to produce cartesian representations of consumer preferences for a set of products. <strong>External</strong> preference mapping uses some sort of other data (the “external” data)–chemical data, DA data, even product-ingredient data–to explain patterns in consumer liking. <strong>Internal</strong> preference mapping treats consumers themselves as variables explaining the products, and uses simple approaches like PCA to produce a low-dimensional but hopefully informative insight into the patterns of consumer liking.</p>
<p>One of the challenges of preference mapping is the seemingly endless set of options for performing it. As reviewed by <span class="citation">Yenket, Chambers IV, and Adhikari (<a href="#ref-yenketCOMPARISON2011">2011</a>)</span>, there are at least 10 distinct approaches to external preference mapping, possibly even more. They each solve slightly different optimization problems, and so produce slightly different results. Therefore, there is a real danger of an analyst going method-by-method until they find one that supports their prior intuition.</p>
<p>On top of that, I personally find that many of the approaches are technically and analytically convoluted and difficult to follow, producing outputs that are prone to misinterpretation. Therefore, in this section we’re going to depart pretty strongly from HGH’s approach: we’re going to entirely ignore <code>SensoMineR::carto()</code> and the related workflow, because I find the method itself opaque and the outputs less-than-useful. Instead, we’re going to focus on (what I believe to be) the simplest tractable tools for these use cases.</p>
<div id="data" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Data<a href="preference-mapping.html#data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To do preference mapping, we of course need some consumer data. We have data on consumer responses to the wines profiled in our DA example in the <code>torriconsFinal.csv</code> file. Let’s load our standard packages and import the data.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="preference-mapping.html#cb349-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb349-2"><a href="preference-mapping.html#cb349-2" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb349-3"><a href="preference-mapping.html#cb349-3" tabindex="-1"></a></span>
<span id="cb349-4"><a href="preference-mapping.html#cb349-4" tabindex="-1"></a>consumer_data <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/torriconsFinal.csv&quot;</span>))</span>
<span id="cb349-5"><a href="preference-mapping.html#cb349-5" tabindex="-1"></a></span>
<span id="cb349-6"><a href="preference-mapping.html#cb349-6" tabindex="-1"></a><span class="co"># We&#39;ll also need the DA data</span></span>
<span id="cb349-7"><a href="preference-mapping.html#cb349-7" tabindex="-1"></a>descriptive_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;data/torriDAFinal.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb349-8"><a href="preference-mapping.html#cb349-8" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="at">.vars =</span> <span class="fu">vars</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="sc">~</span><span class="fu">as.factor</span>(.))</span>
<span id="cb349-9"><a href="preference-mapping.html#cb349-9" tabindex="-1"></a></span>
<span id="cb349-10"><a href="preference-mapping.html#cb349-10" tabindex="-1"></a><span class="co"># And finally let&#39;s take a look at our data</span></span>
<span id="cb349-11"><a href="preference-mapping.html#cb349-11" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(consumer_data) <span class="sc">%&gt;%</span> </span>
<span id="cb349-12"><a href="preference-mapping.html#cb349-12" tabindex="-1"></a>  <span class="co"># This is purely to allow the skimr::skim() to be rendered in PDF, ignore otherwise</span></span>
<span id="cb349-13"><a href="preference-mapping.html#cb349-13" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="6%" />
<col width="10%" />
<col width="6%" />
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_type</th>
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">numeric.mean</th>
<th align="right">numeric.sd</th>
<th align="right">numeric.p0</th>
<th align="right">numeric.p25</th>
<th align="right">numeric.p50</th>
<th align="right">numeric.p75</th>
<th align="right">numeric.p100</th>
<th align="left">numeric.hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">Judge</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">53.500000</td>
<td align="right">30.7435630</td>
<td align="right">1</td>
<td align="right">27.25</td>
<td align="right">53.5</td>
<td align="right">79.75</td>
<td align="right">106</td>
<td align="left">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">Wine Frequency</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.018868</td>
<td align="right">0.8942263</td>
<td align="right">1</td>
<td align="right">1.00</td>
<td align="right">2.0</td>
<td align="right">3.00</td>
<td align="right">4</td>
<td align="left">▇▇▁▅▁</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">IT frequency</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.745283</td>
<td align="right">0.7179511</td>
<td align="right">1</td>
<td align="right">2.00</td>
<td align="right">3.0</td>
<td align="right">3.00</td>
<td align="right">5</td>
<td align="left">▁▅▇▁▁</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">Gender</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1.481132</td>
<td align="right">0.5020175</td>
<td align="right">1</td>
<td align="right">1.00</td>
<td align="right">1.0</td>
<td align="right">2.00</td>
<td align="right">2</td>
<td align="left">▇▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">Age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">38.915094</td>
<td align="right">14.4684339</td>
<td align="right">21</td>
<td align="right">26.00</td>
<td align="right">35.0</td>
<td align="right">51.50</td>
<td align="right">67</td>
<td align="left">▇▃▂▃▃</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">C_MERLOT</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.773585</td>
<td align="right">1.8009681</td>
<td align="right">2</td>
<td align="right">4.00</td>
<td align="right">6.0</td>
<td align="right">7.00</td>
<td align="right">9</td>
<td align="left">▃▃▇▅▅</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">C_SYRAH</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.537736</td>
<td align="right">2.0150601</td>
<td align="right">1</td>
<td align="right">4.00</td>
<td align="right">6.0</td>
<td align="right">7.00</td>
<td align="right">9</td>
<td align="left">▂▆▂▇▅</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">C_ZINFANDEL</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6.056604</td>
<td align="right">1.7611154</td>
<td align="right">1</td>
<td align="right">5.00</td>
<td align="right">6.0</td>
<td align="right">7.00</td>
<td align="right">9</td>
<td align="left">▁▂▂▇▃</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">C_REFOSCO</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.443396</td>
<td align="right">2.0427814</td>
<td align="right">1</td>
<td align="right">4.00</td>
<td align="right">6.0</td>
<td align="right">7.00</td>
<td align="right">9</td>
<td align="left">▂▆▃▇▃</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">I_MERLOT</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.547170</td>
<td align="right">1.9475605</td>
<td align="right">1</td>
<td align="right">3.00</td>
<td align="right">4.0</td>
<td align="right">6.00</td>
<td align="right">8</td>
<td align="left">▅▅▇▅▅</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">I_SYRAH</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.226415</td>
<td align="right">1.9187447</td>
<td align="right">1</td>
<td align="right">4.00</td>
<td align="right">6.0</td>
<td align="right">7.00</td>
<td align="right">8</td>
<td align="left">▂▃▆▅▇</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">I_PRIMITIVO</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5.009434</td>
<td align="right">2.0023571</td>
<td align="right">1</td>
<td align="right">4.00</td>
<td align="right">5.0</td>
<td align="right">6.75</td>
<td align="right">9</td>
<td align="left">▂▇▂▇▂</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">I_REFOSCO</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4.820755</td>
<td align="right">2.2116452</td>
<td align="right">1</td>
<td align="right">3.00</td>
<td align="right">5.0</td>
<td align="right">7.00</td>
<td align="right">9</td>
<td align="left">▅▅▂▇▂</td>
</tr>
</tbody>
</table>
<p>So we have a lot of rows, each one of which represents a judge. In fact, we have two kinds of data in this wide data frame: data about consumer preferences (titled with wine names, like <code>I_SYRAH</code>) and data about the judges themselves (<code>Wine Frequency</code>, <code>Age</code>, etc). Let’s break these up for ease of use.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="preference-mapping.html#cb350-1" tabindex="-1"></a>consumer_demo <span class="ot">&lt;-</span> </span>
<span id="cb350-2"><a href="preference-mapping.html#cb350-2" tabindex="-1"></a>  consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb350-3"><a href="preference-mapping.html#cb350-3" tabindex="-1"></a>  <span class="fu">select</span>(Judge<span class="sc">:</span>Age) <span class="sc">%&gt;%</span></span>
<span id="cb350-4"><a href="preference-mapping.html#cb350-4" tabindex="-1"></a>  <span class="co"># Everything but Age is a factor anyway, let&#39;s fix it</span></span>
<span id="cb350-5"><a href="preference-mapping.html#cb350-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>Age, <span class="sc">~</span><span class="fu">as.factor</span>(.)))</span>
<span id="cb350-6"><a href="preference-mapping.html#cb350-6" tabindex="-1"></a></span>
<span id="cb350-7"><a href="preference-mapping.html#cb350-7" tabindex="-1"></a>consumer_data <span class="ot">&lt;-</span> </span>
<span id="cb350-8"><a href="preference-mapping.html#cb350-8" tabindex="-1"></a>  consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb350-9"><a href="preference-mapping.html#cb350-9" tabindex="-1"></a>  <span class="fu">select</span>(Judge, C_MERLOT<span class="sc">:</span>I_REFOSCO) <span class="sc">%&gt;%</span></span>
<span id="cb350-10"><a href="preference-mapping.html#cb350-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Judge =</span> <span class="fu">as.factor</span>(Judge))</span></code></pre></div>
<p>OK, now we’re ready to start working! Before we do, let’s do a little summary work to get some insight into the data. We might be curious, for example, to get some kind of <span class="math inline">\(mean±se\)</span> estimate for our liking for each wine. Easy enough to do with what we’ve learned so far:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="preference-mapping.html#cb351-1" tabindex="-1"></a>consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb351-2"><a href="preference-mapping.html#cb351-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Judge) <span class="sc">%&gt;%</span></span>
<span id="cb351-3"><a href="preference-mapping.html#cb351-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> name, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb351-4"><a href="preference-mapping.html#cb351-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb351-5"><a href="preference-mapping.html#cb351-5" tabindex="-1"></a>  <span class="fu">stat_summary</span>() <span class="sc">+</span></span>
<span id="cb351-6"><a href="preference-mapping.html#cb351-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb351-7"><a href="preference-mapping.html#cb351-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;mean liking ± se&quot;</span>) <span class="sc">+</span> </span>
<span id="cb351-8"><a href="preference-mapping.html#cb351-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 22 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>See how I scaled that to include the entire range of possible responses on the 9-pt scale? It shows how little variability there actually is in our data.</p>
<p>Anyway, we can see that on average the Californian wines seem to be rated a bit higher in terms of overall liking. If we were interested we might consider pairing the wine types across region (in this case, <a href="https://en.wikipedia.org/wiki/Zinfandel">we would assume Zinfandel and Primitivo are chosen to be matches for each other</a>) and treat this as a 2-factor design. But that is outside our remit at the moment.</p>
</div>
<div id="internal-preference-mapping" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Internal preference mapping<a href="preference-mapping.html#internal-preference-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ll start out nice and easy with an <strong>internal preference map</strong>. In this approach, we treat each consumer as a variable measured on the wine, and we look for combinations of variables that best explain the variation in the wines. Sound familiar? We’re just describing a (covariance) PCA on the consumer data! Let’s dive in.</p>
<p>First, we need to transpose our table so that judges are the variables and wines are the observations:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="preference-mapping.html#cb353-1" tabindex="-1"></a>internal_map <span class="ot">&lt;-</span> </span>
<span id="cb353-2"><a href="preference-mapping.html#cb353-2" tabindex="-1"></a>  consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb353-3"><a href="preference-mapping.html#cb353-3" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;Judge&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb353-4"><a href="preference-mapping.html#cb353-4" tabindex="-1"></a>  <span class="co"># Pretty easy - `t()` is the base-`R` transpose function</span></span>
<span id="cb353-5"><a href="preference-mapping.html#cb353-5" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb353-6"><a href="preference-mapping.html#cb353-6" tabindex="-1"></a>  FactoMineR<span class="sc">::</span><span class="fu">PCA</span>(<span class="at">graph =</span> <span class="cn">FALSE</span>, <span class="at">scale.unit =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Notice that I just used <code>t()</code> to transpose; HGH demonstrated a workflow using the <code>reshape</code> package, which we could replicate with some combination of <code>pivot_*()</code> functions, but this seemed easier for the application.</p>
<p>Let’s take a look at what we got.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="preference-mapping.html#cb354-1" tabindex="-1"></a>internal_coordinates <span class="ot">&lt;-</span> </span>
<span id="cb354-2"><a href="preference-mapping.html#cb354-2" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">point_type =</span> <span class="fu">c</span>(<span class="st">&quot;subject&quot;</span>, <span class="st">&quot;product&quot;</span>),</span>
<span id="cb354-3"><a href="preference-mapping.html#cb354-3" tabindex="-1"></a>         <span class="at">data =</span> <span class="fu">list</span>(internal_map<span class="sc">$</span>var<span class="sc">$</span>coord,</span>
<span id="cb354-4"><a href="preference-mapping.html#cb354-4" tabindex="-1"></a>                     internal_map<span class="sc">$</span>ind<span class="sc">$</span>coord)) <span class="sc">%&gt;%</span></span>
<span id="cb354-5"><a href="preference-mapping.html#cb354-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data, as_tibble, <span class="at">rownames =</span> <span class="st">&quot;label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb354-6"><a href="preference-mapping.html#cb354-6" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">everything</span>())</span>
<span id="cb354-7"><a href="preference-mapping.html#cb354-7" tabindex="-1"></a></span>
<span id="cb354-8"><a href="preference-mapping.html#cb354-8" tabindex="-1"></a><span class="co"># The scales for our factor scores are very different, so we will want to plot</span></span>
<span id="cb354-9"><a href="preference-mapping.html#cb354-9" tabindex="-1"></a><span class="co"># separately and join them up via `patchwork`.</span></span>
<span id="cb354-10"><a href="preference-mapping.html#cb354-10" tabindex="-1"></a></span>
<span id="cb354-11"><a href="preference-mapping.html#cb354-11" tabindex="-1"></a>internal_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb354-12"><a href="preference-mapping.html#cb354-12" tabindex="-1"></a>  <span class="fu">group_by</span>(point_type) <span class="sc">%&gt;%</span></span>
<span id="cb354-13"><a href="preference-mapping.html#cb354-13" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">mean</span>(<span class="fu">abs</span>(.))))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 6
##   point_type Dim.1 Dim.2 Dim.3 Dim.4 Dim.5
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 product    7.84  5.91  6.34  5.47  4.72 
## 2 subject    0.639 0.573 0.542 0.496 0.477</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="preference-mapping.html#cb356-1" tabindex="-1"></a><span class="co"># This is just to avoid re-typing</span></span>
<span id="cb356-2"><a href="preference-mapping.html#cb356-2" tabindex="-1"></a></span>
<span id="cb356-3"><a href="preference-mapping.html#cb356-3" tabindex="-1"></a>axis_labels <span class="ot">&lt;-</span> </span>
<span id="cb356-4"><a href="preference-mapping.html#cb356-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&quot;Dimension 1, &quot;</span>, <span class="fu">round</span>(internal_map<span class="sc">$</span>eig[<span class="dv">1</span>, <span class="dv">2</span>], <span class="dv">2</span>), <span class="st">&quot;% of variance&quot;</span>),</span>
<span id="cb356-5"><a href="preference-mapping.html#cb356-5" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">&quot;Dimension 2, &quot;</span>, <span class="fu">round</span>(internal_map<span class="sc">$</span>eig[<span class="dv">2</span>, <span class="dv">2</span>], <span class="dv">2</span>), <span class="st">&quot;% of variance&quot;</span>))</span>
<span id="cb356-6"><a href="preference-mapping.html#cb356-6" tabindex="-1"></a></span>
<span id="cb356-7"><a href="preference-mapping.html#cb356-7" tabindex="-1"></a><span class="co"># First the product map</span></span>
<span id="cb356-8"><a href="preference-mapping.html#cb356-8" tabindex="-1"></a></span>
<span id="cb356-9"><a href="preference-mapping.html#cb356-9" tabindex="-1"></a>p_internal_products <span class="ot">&lt;-</span> </span>
<span id="cb356-10"><a href="preference-mapping.html#cb356-10" tabindex="-1"></a>  internal_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb356-11"><a href="preference-mapping.html#cb356-11" tabindex="-1"></a>  <span class="fu">filter</span>(point_type <span class="sc">==</span> <span class="st">&quot;product&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-12"><a href="preference-mapping.html#cb356-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Dim<span class="fl">.1</span>, <span class="at">y =</span> Dim<span class="fl">.2</span>)) <span class="sc">+</span> </span>
<span id="cb356-13"><a href="preference-mapping.html#cb356-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb356-14"><a href="preference-mapping.html#cb356-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb356-15"><a href="preference-mapping.html#cb356-15" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb356-16"><a href="preference-mapping.html#cb356-16" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label)) <span class="sc">+</span> </span>
<span id="cb356-17"><a href="preference-mapping.html#cb356-17" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb356-18"><a href="preference-mapping.html#cb356-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Wines, plotted in consumer-liking space&quot;</span>) <span class="sc">+</span> </span>
<span id="cb356-19"><a href="preference-mapping.html#cb356-19" tabindex="-1"></a>  axis_labels <span class="sc">+</span></span>
<span id="cb356-20"><a href="preference-mapping.html#cb356-20" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb356-21"><a href="preference-mapping.html#cb356-21" tabindex="-1"></a></span>
<span id="cb356-22"><a href="preference-mapping.html#cb356-22" tabindex="-1"></a><span class="co"># Then the consumer map</span></span>
<span id="cb356-23"><a href="preference-mapping.html#cb356-23" tabindex="-1"></a></span>
<span id="cb356-24"><a href="preference-mapping.html#cb356-24" tabindex="-1"></a>p_internal_consumers <span class="ot">&lt;-</span> </span>
<span id="cb356-25"><a href="preference-mapping.html#cb356-25" tabindex="-1"></a>  internal_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb356-26"><a href="preference-mapping.html#cb356-26" tabindex="-1"></a>  <span class="fu">filter</span>(point_type <span class="sc">==</span> <span class="st">&quot;subject&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb356-27"><a href="preference-mapping.html#cb356-27" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Dim<span class="fl">.1</span>, <span class="at">y =</span> Dim<span class="fl">.2</span>)) <span class="sc">+</span> </span>
<span id="cb356-28"><a href="preference-mapping.html#cb356-28" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb356-29"><a href="preference-mapping.html#cb356-29" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb356-30"><a href="preference-mapping.html#cb356-30" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb356-31"><a href="preference-mapping.html#cb356-31" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>), <span class="at">ends =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb356-32"><a href="preference-mapping.html#cb356-32" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb356-33"><a href="preference-mapping.html#cb356-33" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb356-34"><a href="preference-mapping.html#cb356-34" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb356-35"><a href="preference-mapping.html#cb356-35" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb356-36"><a href="preference-mapping.html#cb356-36" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Consumers, plotted in wine-linking space&quot;</span>) <span class="sc">+</span> </span>
<span id="cb356-37"><a href="preference-mapping.html#cb356-37" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb356-38"><a href="preference-mapping.html#cb356-38" tabindex="-1"></a></span>
<span id="cb356-39"><a href="preference-mapping.html#cb356-39" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb356-40"><a href="preference-mapping.html#cb356-40" tabindex="-1"></a></span>
<span id="cb356-41"><a href="preference-mapping.html#cb356-41" tabindex="-1"></a>p_internal_consumers <span class="sc">+</span> p_internal_products</span></code></pre></div>
<pre><code>## Warning: ggrepel: 12 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>In the original <strong>R Opus</strong>, HGH filtered the consumers to show those with the highest <span class="math inline">\(cos^2\)</span> values: this measures their effect (in my head I always read “leverage”) on the spatial arrangement of the plotted dimensions. She did this using the base-<code>R</code> plotting options for the <code>carto()</code> function, and I have no idea how it specifies selection - I have not tried to figure out how that function works in detail. Instead, if we wanted to do something similar we could look into the output of <code>PCA()</code> and create a list of influential subjects:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="preference-mapping.html#cb358-1" tabindex="-1"></a>influential_subjects <span class="ot">&lt;-</span> </span>
<span id="cb358-2"><a href="preference-mapping.html#cb358-2" tabindex="-1"></a>  internal_map<span class="sc">$</span>var<span class="sc">$</span>cos2 <span class="sc">%&gt;%</span></span>
<span id="cb358-3"><a href="preference-mapping.html#cb358-3" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;subject&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-4"><a href="preference-mapping.html#cb358-4" tabindex="-1"></a>  <span class="fu">filter</span>(Dim<span class="fl">.1</span> <span class="sc">&gt;</span> <span class="fl">0.6</span> <span class="sc">|</span> Dim<span class="fl">.2</span> <span class="sc">&gt;</span> <span class="fl">0.6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb358-5"><a href="preference-mapping.html#cb358-5" tabindex="-1"></a>  <span class="fu">pull</span>(subject)</span>
<span id="cb358-6"><a href="preference-mapping.html#cb358-6" tabindex="-1"></a></span>
<span id="cb358-7"><a href="preference-mapping.html#cb358-7" tabindex="-1"></a><span class="co"># We can then use these to filter our plot:</span></span>
<span id="cb358-8"><a href="preference-mapping.html#cb358-8" tabindex="-1"></a></span>
<span id="cb358-9"><a href="preference-mapping.html#cb358-9" tabindex="-1"></a>internal_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb358-10"><a href="preference-mapping.html#cb358-10" tabindex="-1"></a>  <span class="fu">filter</span>(point_type <span class="sc">==</span> <span class="st">&quot;subject&quot;</span>,</span>
<span id="cb358-11"><a href="preference-mapping.html#cb358-11" tabindex="-1"></a>         label <span class="sc">%in%</span> influential_subjects) <span class="sc">%&gt;%</span></span>
<span id="cb358-12"><a href="preference-mapping.html#cb358-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Dim<span class="fl">.1</span>, <span class="at">y =</span> Dim<span class="fl">.2</span>)) <span class="sc">+</span> </span>
<span id="cb358-13"><a href="preference-mapping.html#cb358-13" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb358-14"><a href="preference-mapping.html#cb358-14" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb358-15"><a href="preference-mapping.html#cb358-15" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb358-16"><a href="preference-mapping.html#cb358-16" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>), <span class="at">ends =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb358-17"><a href="preference-mapping.html#cb358-17" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb358-18"><a href="preference-mapping.html#cb358-18" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb358-19"><a href="preference-mapping.html#cb358-19" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb358-20"><a href="preference-mapping.html#cb358-20" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb358-21"><a href="preference-mapping.html#cb358-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Influential consumers on the first 2 dimensions&quot;</span>) <span class="sc">+</span> </span>
<span id="cb358-22"><a href="preference-mapping.html#cb358-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>We get fewer points than HGH did; I am assuming that the <code>SensoMineR</code> function is filtering its subjects that are influential on ANY of the dimensions of the PCA, not just on the first 2 dimensions, but that seems to be counterindicated (to me) for looking at these 2-dimensional biplots.</p>
<p>One step that HGH didn’t take was to cluster the consumers according to their patterns of liking. This is a common end goal of preference mapping in general, and HGH pursued it in the original <strong>R Opus</strong> section on <em>external</em> preference mapping. However, there is no reason we can’t do it with the results of an internal preference map:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="preference-mapping.html#cb359-1" tabindex="-1"></a>internal_consumer_cluster <span class="ot">&lt;-</span> </span>
<span id="cb359-2"><a href="preference-mapping.html#cb359-2" tabindex="-1"></a>  consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb359-3"><a href="preference-mapping.html#cb359-3" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;Judge&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb359-4"><a href="preference-mapping.html#cb359-4" tabindex="-1"></a>  <span class="fu">dist</span>(<span class="at">method =</span> <span class="st">&quot;euclidean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb359-5"><a href="preference-mapping.html#cb359-5" tabindex="-1"></a>  <span class="fu">hclust</span>(<span class="at">method =</span> <span class="st">&quot;ward.D2&quot;</span>) </span>
<span id="cb359-6"><a href="preference-mapping.html#cb359-6" tabindex="-1"></a></span>
<span id="cb359-7"><a href="preference-mapping.html#cb359-7" tabindex="-1"></a>internal_consumer_cluster <span class="sc">%&gt;%</span></span>
<span id="cb359-8"><a href="preference-mapping.html#cb359-8" tabindex="-1"></a>  factoextra<span class="sc">::</span><span class="fu">fviz_dend</span>(<span class="at">k =</span> <span class="dv">3</span>, <span class="at">rect =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb359-9"><a href="preference-mapping.html#cb359-9" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>()</span></code></pre></div>
<pre><code>## Scale for colour is already present.
## Adding another scale for colour, which will replace the existing scale.</code></pre>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>I think there are plausibly 3 clusters of consumers; we could also explore the possibility that there are 2, 4, or even 5. However, 3 seems good to me, because the distance between groups 2 and 3 (blue and green) is quite large, so forcing them to remain in a single group seems less plausible than splitting them.</p>
<p>We can take this grouping information and project it back into our preference maps in different ways. I am going to opt for simply replacing the original labels with labels colored by group membership.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="preference-mapping.html#cb361-1" tabindex="-1"></a>p_internal_consumers <span class="ot">&lt;-</span> </span>
<span id="cb361-2"><a href="preference-mapping.html#cb361-2" tabindex="-1"></a>  p_internal_consumers <span class="sc">%&gt;%</span></span>
<span id="cb361-3"><a href="preference-mapping.html#cb361-3" tabindex="-1"></a>  ggedit<span class="sc">::</span><span class="fu">remove_geom</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>) <span class="sc">+</span></span>
<span id="cb361-4"><a href="preference-mapping.html#cb361-4" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> label, </span>
<span id="cb361-5"><a href="preference-mapping.html#cb361-5" tabindex="-1"></a>                               <span class="at">color =</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(internal_consumer_cluster, <span class="at">k =</span> <span class="dv">3</span>))),</span>
<span id="cb361-6"><a href="preference-mapping.html#cb361-6" tabindex="-1"></a>                           <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span> </span>
<span id="cb361-7"><a href="preference-mapping.html#cb361-7" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="st">&quot;group&quot;</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb361-8"><a href="preference-mapping.html#cb361-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;ggedit&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="preference-mapping.html#cb363-1" tabindex="-1"></a>p_internal_consumers <span class="sc">+</span> p_internal_products</span></code></pre></div>
<pre><code>## Warning: ggrepel: 12 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We can see that the purple and teal-ish groups are well-separated in this space, whereas the bright green group is not. I suspect (and leave it as an exercise to find out) that this group would be better separated in a third dimension.</p>
<p>We can then use the clusteres identified here to ask questions about, for example, consumer demographic groups. A quick way to do per-group summaries of (often qualitative) variables is using the <code>skimr::skim()</code> function with <code>group_by()</code>.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="preference-mapping.html#cb365-1" tabindex="-1"></a>consumer_demo <span class="sc">%&gt;%</span></span>
<span id="cb365-2"><a href="preference-mapping.html#cb365-2" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">cluster =</span> <span class="fu">cutree</span>(internal_consumer_cluster, <span class="at">k =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb365-3"><a href="preference-mapping.html#cb365-3" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb365-4"><a href="preference-mapping.html#cb365-4" tabindex="-1"></a>  skimr<span class="sc">::</span><span class="fu">skim</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb365-5"><a href="preference-mapping.html#cb365-5" tabindex="-1"></a>  <span class="co"># This is purely to allow the skimr::skim() to be rendered in PDF, ignore otherwise</span></span>
<span id="cb365-6"><a href="preference-mapping.html#cb365-6" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<colgroup>
<col width="4%" />
<col width="7%" />
<col width="3%" />
<col width="4%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="12%" />
<col width="6%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="6%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_type</th>
<th align="left">skim_variable</th>
<th align="right">cluster</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">factor.ordered</th>
<th align="right">factor.n_unique</th>
<th align="left">factor.top_counts</th>
<th align="right">numeric.mean</th>
<th align="right">numeric.sd</th>
<th align="right">numeric.p0</th>
<th align="right">numeric.p25</th>
<th align="right">numeric.p50</th>
<th align="right">numeric.p75</th>
<th align="right">numeric.p100</th>
<th align="left">numeric.hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">factor</td>
<td align="left">Judge</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">56</td>
<td align="left">1: 1, 4: 1, 6: 1, 8: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Judge</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">27</td>
<td align="left">2: 1, 5: 1, 13: 1, 21: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">Judge</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">23</td>
<td align="left">3: 1, 7: 1, 18: 1, 19: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Wine Frequency</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">2: 22, 1: 16, 3: 16, 4: 2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">Wine Frequency</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">1: 12, 2: 6, 3: 6, 4: 3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Wine Frequency</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">2: 12, 1: 7, 3: 3, 4: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">IT frequency</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">3: 35, 2: 16, 1: 2, 4: 2</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">IT frequency</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">3: 11, 2: 10, 4: 5, 1: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">IT frequency</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">3: 14, 2: 5, 4: 3, 1: 1</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Gender</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">1: 28, 2: 28</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">Gender</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">1: 14, 2: 13</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">Gender</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">1: 13, 2: 10</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">Age</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">36.92857</td>
<td align="right">14.41194</td>
<td align="right">21</td>
<td align="right">24.75</td>
<td align="right">30.5</td>
<td align="right">49.25</td>
<td align="right">67</td>
<td align="left">▇▂▂▂▂</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">Age</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">40.07407</td>
<td align="right">14.83739</td>
<td align="right">21</td>
<td align="right">26.50</td>
<td align="right">38.0</td>
<td align="right">51.50</td>
<td align="right">66</td>
<td align="left">▇▃▂▃▃</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">Age</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">42.39130</td>
<td align="right">13.97641</td>
<td align="right">24</td>
<td align="right">30.50</td>
<td align="right">39.0</td>
<td align="right">54.50</td>
<td align="right">66</td>
<td align="left">▇▆▃▅▅</td>
</tr>
</tbody>
</table>
<p>We can see some interesting (if minor!) differences in these groups. Group 1, for example, has more answers for “2” and “1” for wine consumption frequency, proportionally–since I don’t have the original data, I have no idea if this is more or less frequent. I am guessing less, though, because group 1 also has a lower mean age and less of a long tale in the Age variable.</p>
</div>
<div id="external-preference-mapping" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> External preference mapping<a href="preference-mapping.html#external-preference-mapping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As I mentioned above, the range of possible approaches to external preference mapping is quite large <span class="citation">(<a href="#ref-yenketCOMPARISON2011">Yenket, Chambers IV, and Adhikari 2011</a>)</span>, and I have little interest in exploring all of them. In particular, I find both the interface and the documentation for <code>SensoMineR</code> a little hard to grasp, so I am going to avoid its use in favor of approaches that will yield largely the same answers but with more transparencyt (for me).</p>
<div id="partial-least-squares-regression" class="section level3 hasAnchor" number="11.3.1">
<h3><span class="header-section-number">11.3.1</span> Partial Least Squares Regression<a href="preference-mapping.html#partial-least-squares-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I believe the most common tool for preference mapping currently used in sensory evaluation is Partial Least Squares Regression (PLS-R). PLS-R is one of a larger family of PLS methods. All PLS methods are concerned with the explanation of two data tables that contain measurements on the same set of observations: in other words, the data tables have the same rows (the observations, say, in our case, <em>wines</em>) but different columns (measurements, in our case we have one table with DA ratings and one with consumer ratings). This kind of dual-table data structure is common in food science: we might have a set of chemical measurements and a set of descriptive ratings, or a set of descriptive ratings and consumer liking measurements (as we do here), or many other possible configurations.</p>
<p>There are other PLS approaches we will not consider here: correlation (in which the two tables are simultaneously explained) and path modeling (which proposes causal links among the variables in multiple tables). We like PLS-Regression in this case because we want to model an <em>explanatory</em> relationship: we want to know how the profiles of (mean) DA ratings in our <code>descriptive_data</code> table explains the patterns of consumer liking we see in our <code>consumer_data</code> table. In addition, to quote <span class="citation">Hervé Abdi and Williams (<a href="#ref-abdiPartial2013">2013, 567</a>)</span>:</p>
<blockquote>
<p>As a regression technique, PLSR [sic] is used to predict a whole table of data (by contrast with standard regression which predicts one variable only), and it can also handle the case of multicolinear predictors (i.e., when the predictors are not linearly independent). These features make PLSR [sic] a very versatile tool because it can be used with very large data sets for which standard regression methods fail.</p>
</blockquote>
<p>That all sounds pretty good! To paraphrase the same authors, PLS-R finds a <em>single set</em> of latent variables from the predictor matrix (<code>descriptive_data</code> for us) that best explains the variation in <code>consumer_data</code>.</p>
<p>I am not going to try to do further explanation of PLS-R, because it is a rather complex, iterative fitting procedure. The outcome, however, is relatively easy to understand, and we will talk through it once we generate it. For this, we’re going to need to load some new packages!</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="preference-mapping.html#cb366-1" tabindex="-1"></a><span class="fu">library</span>(pls)</span>
<span id="cb366-2"><a href="preference-mapping.html#cb366-2" tabindex="-1"></a></span>
<span id="cb366-3"><a href="preference-mapping.html#cb366-3" tabindex="-1"></a>descriptive_means <span class="ot">&lt;-</span> </span>
<span id="cb366-4"><a href="preference-mapping.html#cb366-4" tabindex="-1"></a>  descriptive_data <span class="sc">%&gt;%</span></span>
<span id="cb366-5"><a href="preference-mapping.html#cb366-5" tabindex="-1"></a>  <span class="fu">select</span>(ProductName, Red_berry<span class="sc">:</span>Astringent) <span class="sc">%&gt;%</span></span>
<span id="cb366-6"><a href="preference-mapping.html#cb366-6" tabindex="-1"></a>  <span class="fu">group_by</span>(ProductName) <span class="sc">%&gt;%</span></span>
<span id="cb366-7"><a href="preference-mapping.html#cb366-7" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean)) <span class="sc">%&gt;%</span></span>
<span id="cb366-8"><a href="preference-mapping.html#cb366-8" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;ProductName&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb366-9"><a href="preference-mapping.html#cb366-9" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb366-10"><a href="preference-mapping.html#cb366-10" tabindex="-1"></a></span>
<span id="cb366-11"><a href="preference-mapping.html#cb366-11" tabindex="-1"></a>consumer_data_wide <span class="ot">&lt;-</span> </span>
<span id="cb366-12"><a href="preference-mapping.html#cb366-12" tabindex="-1"></a>  consumer_data <span class="sc">%&gt;%</span></span>
<span id="cb366-13"><a href="preference-mapping.html#cb366-13" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&quot;Judge&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb366-14"><a href="preference-mapping.html#cb366-14" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span></span>
<span id="cb366-15"><a href="preference-mapping.html#cb366-15" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb366-16"><a href="preference-mapping.html#cb366-16" tabindex="-1"></a></span>
<span id="cb366-17"><a href="preference-mapping.html#cb366-17" tabindex="-1"></a>pls_data <span class="ot">&lt;-</span> </span>
<span id="cb366-18"><a href="preference-mapping.html#cb366-18" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">x =</span> descriptive_means,</span>
<span id="cb366-19"><a href="preference-mapping.html#cb366-19" tabindex="-1"></a>       <span class="at">y =</span> consumer_data_wide)</span>
<span id="cb366-20"><a href="preference-mapping.html#cb366-20" tabindex="-1"></a></span>
<span id="cb366-21"><a href="preference-mapping.html#cb366-21" tabindex="-1"></a><span class="co"># `plsr()` has an interface that is built to act like `lm()` or `aov()`</span></span>
<span id="cb366-22"><a href="preference-mapping.html#cb366-22" tabindex="-1"></a>pls_fit <span class="ot">&lt;-</span> </span>
<span id="cb366-23"><a href="preference-mapping.html#cb366-23" tabindex="-1"></a>  <span class="fu">plsr</span>(y <span class="sc">~</span> x, </span>
<span id="cb366-24"><a href="preference-mapping.html#cb366-24" tabindex="-1"></a>       <span class="at">data =</span> pls_data, </span>
<span id="cb366-25"><a href="preference-mapping.html#cb366-25" tabindex="-1"></a>       <span class="at">scale =</span> <span class="cn">TRUE</span>)</span>
<span id="cb366-26"><a href="preference-mapping.html#cb366-26" tabindex="-1"></a></span>
<span id="cb366-27"><a href="preference-mapping.html#cb366-27" tabindex="-1"></a><span class="fu">summary</span>(pls_fit)</span></code></pre></div>
<pre><code>## Data:    X dimension: 8 20 
##  Y dimension: 8 106
## Fit method: kernelpls
## Number of components considered: 7
## TRAINING: % variance explained
##        1 comps  2 comps  3 comps  4 comps  5 comps  6 comps  7 comps
## X    3.660e+01  61.8849   74.726   84.556   93.330    98.51      100
## 1    1.793e+00   5.6562   11.742   41.441   90.691    90.85      100
## 2    1.860e+01  43.9844   46.198   62.851   65.184    92.07      100
## 3    7.218e+00  10.7913   14.893   22.859   94.121    95.10      100
....</code></pre>
<p>I only printed out the first few lines (as otherwise the <code>summary()</code> function will print several hundred lines). Overall we see <em>almost</em> the same results as HGH did (good news). However, we are not exactly the same in terms of variance explained. I wonder if this is because HGH lost subject #1 in data wrangling? I can’t explain the difference otherwise. We’ll see that our solutions do start to diverge as we go on.</p>
<p>HGH decided to only examine 2 components, but I believe that if we investigate cross-validation we would probably choose to retain only a single component based on <span class="math inline">\(PRESS\)</span> values:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="preference-mapping.html#cb368-1" tabindex="-1"></a>pls_val <span class="ot">&lt;-</span> <span class="fu">plsr</span>(y <span class="sc">~</span> x, <span class="at">data =</span> pls_data, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">validation =</span> <span class="st">&quot;LOO&quot;</span>)</span>
<span id="cb368-2"><a href="preference-mapping.html#cb368-2" tabindex="-1"></a></span>
<span id="cb368-3"><a href="preference-mapping.html#cb368-3" tabindex="-1"></a><span class="co"># PRESS values for the predictor (DA) variables</span></span>
<span id="cb368-4"><a href="preference-mapping.html#cb368-4" tabindex="-1"></a>pls_val<span class="sc">$</span>validation<span class="sc">$</span>PRESS[<span class="dv">1</span>, ]</span></code></pre></div>
<pre><code>##  1 comps  2 comps  3 comps  4 comps  5 comps  6 comps 
## 43.08863 62.24039 78.94974 62.31154 56.22270 87.64232</code></pre>
<p>We can see that <span class="math inline">\(PRESS\)</span> is lowest with only a single component.</p>
<p>…but, I am lazy and more interested in showing <em>how</em> to do things than making the multiple plots and analyses we’d need for 3 dimensions. I leave investigating the 3rd component as an exercise for the reader.</p>
<p>Following our typical practice, we will see how to extract elements of the output of <code>plsr()</code> to produce nicer looking plots in <code>ggplot2</code>. This will take a little digging because the <code>pls</code> package makes use of a lot of (what I consider) tricky and obtuse indexing and object formats. Bear with me.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="preference-mapping.html#cb370-1" tabindex="-1"></a><span class="co"># The &quot;scores&quot; are the factor scores for the observations (wines) based on the</span></span>
<span id="cb370-2"><a href="preference-mapping.html#cb370-2" tabindex="-1"></a><span class="co"># predictor (DA) variables</span></span>
<span id="cb370-3"><a href="preference-mapping.html#cb370-3" tabindex="-1"></a>pls_scores <span class="ot">&lt;-</span> <span class="fu">scores</span>(pls_fit)</span>
<span id="cb370-4"><a href="preference-mapping.html#cb370-4" tabindex="-1"></a></span>
<span id="cb370-5"><a href="preference-mapping.html#cb370-5" tabindex="-1"></a><span class="co"># Note this ugly output object of class &quot;scores&quot;.  This is a problem.</span></span>
<span id="cb370-6"><a href="preference-mapping.html#cb370-6" tabindex="-1"></a>pls_scores</span></code></pre></div>
<pre><code>##                  Comp 1     Comp 2     Comp 3      Comp 4      Comp 5
## C_MERLOT     1.48290560 -1.0856932  1.6664093  0.08429563  0.67322911
## C_SYRAH      2.84859866 -2.6602500 -1.6667701  1.55380857 -1.32209708
## C_ZINFANDEL  0.03184129 -0.9422643 -1.6209039 -2.16194022  0.08136815
## C_REFOSCO   -0.43645910 -1.8055096  0.6126194  0.10221889  2.47673917
## I_MERLOT     2.34624636  2.6446633  1.9018586  0.80383273 -0.57175907
## I_SYRAH     -3.51138619 -1.1718605  1.6098890 -1.03261515 -1.84741358
## I_PRIMITIVO  1.58414715  3.3609231 -1.1958901 -1.20118210  0.15460504
## I_REFOSCO   -4.34589378  1.6599913 -1.3072122  1.85158164  0.35532825
##                 Comp 6       Comp 7
## C_MERLOT    -1.1483719 -0.938560264
## C_SYRAH      0.4962983 -0.009963997
## C_ZINFANDEL -1.3552622  0.470925662
## C_REFOSCO    1.1209200  0.409238012
## I_MERLOT    -0.4332254  0.739342596
## I_SYRAH      0.7803878 -0.057086046
## I_PRIMITIVO  1.1672424 -0.509146097
## I_REFOSCO   -0.6279891 -0.104749865
## attr(,&quot;class&quot;)
## [1] &quot;scores&quot;
## attr(,&quot;explvar&quot;)
##    Comp 1    Comp 2    Comp 3    Comp 4    Comp 5    Comp 6    Comp 7 
## 36.598160 25.286782 12.841009  9.829632  8.774663  5.176661  1.493093</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="preference-mapping.html#cb372-1" tabindex="-1"></a><span class="co"># My solution is old-fashioned class coercion: </span></span>
<span id="cb372-2"><a href="preference-mapping.html#cb372-2" tabindex="-1"></a><span class="fu">class</span>(pls_scores) <span class="ot">&lt;-</span> <span class="st">&quot;matrix&quot;</span></span>
<span id="cb372-3"><a href="preference-mapping.html#cb372-3" tabindex="-1"></a></span>
<span id="cb372-4"><a href="preference-mapping.html#cb372-4" tabindex="-1"></a>pls_scores <span class="ot">&lt;-</span> </span>
<span id="cb372-5"><a href="preference-mapping.html#cb372-5" tabindex="-1"></a>  pls_scores <span class="sc">%&gt;%</span> </span>
<span id="cb372-6"><a href="preference-mapping.html#cb372-6" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;wine&quot;</span>)</span>
<span id="cb372-7"><a href="preference-mapping.html#cb372-7" tabindex="-1"></a></span>
<span id="cb372-8"><a href="preference-mapping.html#cb372-8" tabindex="-1"></a>pls_scores</span></code></pre></div>
<pre><code>## # A tibble: 8 × 8
##   wine        `Comp 1` `Comp 2` `Comp 3` `Comp 4` `Comp 5` `Comp 6` `Comp 7`
##   &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 C_MERLOT      1.48     -1.09     1.67    0.0843   0.673    -1.15  -0.939  
## 2 C_SYRAH       2.85     -2.66    -1.67    1.55    -1.32      0.496 -0.00996
## 3 C_ZINFANDEL   0.0318   -0.942   -1.62   -2.16     0.0814   -1.36   0.471  
## 4 C_REFOSCO    -0.436    -1.81     0.613   0.102    2.48      1.12   0.409  
## 5 I_MERLOT      2.35      2.64     1.90    0.804   -0.572    -0.433  0.739  
## 6 I_SYRAH      -3.51     -1.17     1.61   -1.03    -1.85      0.780 -0.0571 
## 7 I_PRIMITIVO   1.58      3.36    -1.20   -1.20     0.155     1.17  -0.509  
## 8 I_REFOSCO    -4.35      1.66    -1.31    1.85     0.355    -0.628 -0.105</code></pre>
<p>We have to take the same approach for the loadings:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="preference-mapping.html#cb374-1" tabindex="-1"></a><span class="co"># The &quot;scores&quot; are the factor loadings for the predictor (DA) variables that</span></span>
<span id="cb374-2"><a href="preference-mapping.html#cb374-2" tabindex="-1"></a><span class="co"># explain how the scores for the wines are generated.</span></span>
<span id="cb374-3"><a href="preference-mapping.html#cb374-3" tabindex="-1"></a>pls_loadings <span class="ot">&lt;-</span> <span class="fu">loadings</span>(pls_fit)</span>
<span id="cb374-4"><a href="preference-mapping.html#cb374-4" tabindex="-1"></a></span>
<span id="cb374-5"><a href="preference-mapping.html#cb374-5" tabindex="-1"></a><span class="fu">class</span>(pls_loadings) <span class="ot">&lt;-</span> <span class="st">&quot;matrix&quot;</span></span>
<span id="cb374-6"><a href="preference-mapping.html#cb374-6" tabindex="-1"></a></span>
<span id="cb374-7"><a href="preference-mapping.html#cb374-7" tabindex="-1"></a>pls_loadings <span class="ot">&lt;-</span> </span>
<span id="cb374-8"><a href="preference-mapping.html#cb374-8" tabindex="-1"></a>  pls_loadings <span class="sc">%&gt;%</span></span>
<span id="cb374-9"><a href="preference-mapping.html#cb374-9" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;descriptor&quot;</span>)</span>
<span id="cb374-10"><a href="preference-mapping.html#cb374-10" tabindex="-1"></a></span>
<span id="cb374-11"><a href="preference-mapping.html#cb374-11" tabindex="-1"></a>pls_loadings</span></code></pre></div>
<pre><code>## # A tibble: 20 × 8
##    descriptor     `Comp 1` `Comp 2` `Comp 3` `Comp 4` `Comp 5` `Comp 6` `Comp 7`
##    &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 Red_berry      -0.299    -0.0372  0.255     0.0284 -0.161     0.333   0.317  
##  2 Dark_berry     -0.331     0.0726 -0.124     0.127   0.135    -0.108  -0.517  
##  3 Jam            -0.362    -0.0338  0.0276   -0.0759 -0.102     0.155  -0.174  
##  4 Dried_fruit    -0.0884    0.214   0.00334   0.192   0.600    -0.129  -0.0280 
##  5 Artificial_fr… -0.340     0.0425 -0.0836    0.111  -0.215     0.113  -0.337  
##  6 Chocolate       0.00735  -0.329  -0.265     0.126  -0.367    -0.0988 -0.133  
##  7 Vanilla        -0.227    -0.335  -0.0582    0.0340 -0.0204    0.251   0.0659 
##  8 Oak             0.205    -0.243  -0.0606    0.153   0.401     0.248  -0.192  
##  9 Burned          0.239    -0.217  -0.245     0.239  -0.214    -0.119  -0.0742 
## 10 Leather         0.261     0.244  -0.174    -0.139   0.00743   0.314  -0.103  
## 11 Earthy          0.299     0.188  -0.164    -0.115  -0.201    -0.157   0.0185 
## 12 Spicy           0.118     0.0269 -0.0704    0.580  -0.0442    0.433   0.313  
## 13 Pepper          0.188     0.187   0.359     0.273  -0.00282  -0.286  -0.234  
## 14 Grassy         -0.253     0.224   0.199     0.157  -0.203    -0.251   0.178  
## 15 Medicinal       0.187     0.281  -0.0652   -0.385  -0.0773    0.214   0.00614
## 16 Band-aid        0.250     0.275  -0.0976   -0.0698 -0.231     0.221  -0.0170 
## 17 Sour           -0.0778    0.370  -0.262    -0.129   0.0735    0.226  -0.112  
## 18 Bitter         -0.166     0.270  -0.344     0.145  -0.0339   -0.247   0.325  
## 19 Alcohol        -0.0999   -0.103  -0.475    -0.287   0.230    -0.126   0.317  
## 20 Astringent      0.120     0.282  -0.349     0.307   0.00121  -0.0517 -0.0935</code></pre>
<p>Now we can make the first two plots that HGH showed:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="preference-mapping.html#cb376-1" tabindex="-1"></a><span class="co"># We&#39;ll reuse this</span></span>
<span id="cb376-2"><a href="preference-mapping.html#cb376-2" tabindex="-1"></a></span>
<span id="cb376-3"><a href="preference-mapping.html#cb376-3" tabindex="-1"></a>axis_labels <span class="ot">&lt;-</span> </span>
<span id="cb376-4"><a href="preference-mapping.html#cb376-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">&quot;Dimension 1, &quot;</span>, <span class="fu">round</span>(<span class="fu">explvar</span>(pls_fit)[<span class="dv">1</span>], <span class="dv">1</span>), <span class="st">&quot;% of predictor (DA) variance&quot;</span>),</span>
<span id="cb376-5"><a href="preference-mapping.html#cb376-5" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">&quot;Dimension 2, &quot;</span>, <span class="fu">round</span>(<span class="fu">explvar</span>(pls_fit)[<span class="dv">2</span>], <span class="dv">1</span>), <span class="st">&quot;% of predictor (DA) variance&quot;</span>))</span>
<span id="cb376-6"><a href="preference-mapping.html#cb376-6" tabindex="-1"></a></span>
<span id="cb376-7"><a href="preference-mapping.html#cb376-7" tabindex="-1"></a>pls_scores <span class="sc">%&gt;%</span></span>
<span id="cb376-8"><a href="preference-mapping.html#cb376-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb376-9"><a href="preference-mapping.html#cb376-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb376-10"><a href="preference-mapping.html#cb376-10" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb376-11"><a href="preference-mapping.html#cb376-11" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb376-12"><a href="preference-mapping.html#cb376-12" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> wine)) <span class="sc">+</span> </span>
<span id="cb376-13"><a href="preference-mapping.html#cb376-13" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb376-14"><a href="preference-mapping.html#cb376-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb376-15"><a href="preference-mapping.html#cb376-15" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb376-16"><a href="preference-mapping.html#cb376-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Scores plot for wines, based on DA (predictor) data&quot;</span>)</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>This plot is quite different from HGH’s, but I confirmed that even using the same base-<code>R</code> plotting methods, I got the same plot shown here (but uglier). Is it possible subject #1 made that big a difference?</p>
<p>As you might guess, our loadings are also going to end up somewhat different:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="preference-mapping.html#cb377-1" tabindex="-1"></a>pls_loadings <span class="sc">%&gt;%</span></span>
<span id="cb377-2"><a href="preference-mapping.html#cb377-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb377-3"><a href="preference-mapping.html#cb377-3" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb377-4"><a href="preference-mapping.html#cb377-4" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb377-5"><a href="preference-mapping.html#cb377-5" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb377-6"><a href="preference-mapping.html#cb377-6" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>), <span class="at">ends =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb377-7"><a href="preference-mapping.html#cb377-7" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb377-8"><a href="preference-mapping.html#cb377-8" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> descriptor)) <span class="sc">+</span> </span>
<span id="cb377-9"><a href="preference-mapping.html#cb377-9" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb377-10"><a href="preference-mapping.html#cb377-10" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb377-11"><a href="preference-mapping.html#cb377-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Loadings plot for wines, based on DA (predictor) data&quot;</span>) <span class="sc">+</span></span>
<span id="cb377-12"><a href="preference-mapping.html#cb377-12" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="preference-mapping.html#cb378-1" tabindex="-1"></a><span class="co"># We start with calculating the correlation betwee the original predictors and</span></span>
<span id="cb378-2"><a href="preference-mapping.html#cb378-2" tabindex="-1"></a><span class="co"># the factor scores for the wines from the DA in the PLS fit.</span></span>
<span id="cb378-3"><a href="preference-mapping.html#cb378-3" tabindex="-1"></a><span class="fu">cor</span>(pls_data<span class="sc">$</span>x, <span class="fu">column_to_rownames</span>(pls_scores, <span class="st">&quot;wine&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb378-4"><a href="preference-mapping.html#cb378-4" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;descriptor&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb378-5"><a href="preference-mapping.html#cb378-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb378-6"><a href="preference-mapping.html#cb378-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb378-7"><a href="preference-mapping.html#cb378-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb378-8"><a href="preference-mapping.html#cb378-8" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_circle</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> x, <span class="at">y0 =</span> y, <span class="at">r =</span> r),</span>
<span id="cb378-9"><a href="preference-mapping.html#cb378-9" tabindex="-1"></a>                       <span class="at">data =</span> <span class="fu">crossing</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fl">0.5</span>), <span class="dv">1</span>)),</span>
<span id="cb378-10"><a href="preference-mapping.html#cb378-10" tabindex="-1"></a>                       <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb378-11"><a href="preference-mapping.html#cb378-11" tabindex="-1"></a>                       <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb378-12"><a href="preference-mapping.html#cb378-12" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb378-13"><a href="preference-mapping.html#cb378-13" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.05</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>), <span class="at">ends =</span> <span class="st">&quot;first&quot;</span>),</span>
<span id="cb378-14"><a href="preference-mapping.html#cb378-14" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb378-15"><a href="preference-mapping.html#cb378-15" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb378-16"><a href="preference-mapping.html#cb378-16" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> descriptor), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb378-17"><a href="preference-mapping.html#cb378-17" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb378-18"><a href="preference-mapping.html#cb378-18" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb378-19"><a href="preference-mapping.html#cb378-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Correlation between predictor (DA) variables and PLS scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb378-20"><a href="preference-mapping.html#cb378-20" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The correlation plot gives us similar information to the loadings plot, above, but it is scaled so that the squared distance between each descriptor and the origin represents the amount of variance for that variable explained by the two dimensions visualized. The dashed circles are a visual aid for 50% and 100% of variance. For this, it is clear that our 2-dimensional PLS-R fit does a good job of explaining most of the variation in the large majority of descriptors; notable exceptions are <code>Alcohol</code>, <code>Dried_fruit</code>, and <code>Spicy</code>.</p>
<p>We can take the same approach to understand our outcome (consumer) variables:</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="preference-mapping.html#cb379-1" tabindex="-1"></a><span class="fu">cor</span>(pls_data<span class="sc">$</span>y, <span class="fu">column_to_rownames</span>(pls_scores, <span class="st">&quot;wine&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb379-2"><a href="preference-mapping.html#cb379-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;consumer&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb379-3"><a href="preference-mapping.html#cb379-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb379-4"><a href="preference-mapping.html#cb379-4" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb379-5"><a href="preference-mapping.html#cb379-5" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb379-6"><a href="preference-mapping.html#cb379-6" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_circle</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> x, <span class="at">y0 =</span> y, <span class="at">r =</span> r),</span>
<span id="cb379-7"><a href="preference-mapping.html#cb379-7" tabindex="-1"></a>                       <span class="at">data =</span> <span class="fu">crossing</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fl">0.5</span>), <span class="dv">1</span>)),</span>
<span id="cb379-8"><a href="preference-mapping.html#cb379-8" tabindex="-1"></a>                       <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb379-9"><a href="preference-mapping.html#cb379-9" tabindex="-1"></a>                       <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb379-10"><a href="preference-mapping.html#cb379-10" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb379-11"><a href="preference-mapping.html#cb379-11" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> consumer), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb379-12"><a href="preference-mapping.html#cb379-12" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb379-13"><a href="preference-mapping.html#cb379-13" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb379-14"><a href="preference-mapping.html#cb379-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Correlation between predicted (consumer) variables and PLS scores&quot;</span>) <span class="sc">+</span></span>
<span id="cb379-15"><a href="preference-mapping.html#cb379-15" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>And this is where our external preference map can come in. Let’s go ahead and segment these consumers by the clusters we identified previously:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="preference-mapping.html#cb380-1" tabindex="-1"></a><span class="fu">cor</span>(pls_data<span class="sc">$</span>y, <span class="fu">column_to_rownames</span>(pls_scores, <span class="st">&quot;wine&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb380-2"><a href="preference-mapping.html#cb380-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;consumer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb380-3"><a href="preference-mapping.html#cb380-3" tabindex="-1"></a>  <span class="co"># Notice we are relying on positional matching here, generally a bad idea</span></span>
<span id="cb380-4"><a href="preference-mapping.html#cb380-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">as.factor</span>(<span class="fu">cutree</span>(internal_consumer_cluster, <span class="at">k =</span> <span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb380-5"><a href="preference-mapping.html#cb380-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span>)) <span class="sc">+</span> </span>
<span id="cb380-6"><a href="preference-mapping.html#cb380-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb380-7"><a href="preference-mapping.html#cb380-7" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linewidth =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb380-8"><a href="preference-mapping.html#cb380-8" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">geom_circle</span>(<span class="fu">aes</span>(<span class="at">x0 =</span> x, <span class="at">y0 =</span> y, <span class="at">r =</span> r),</span>
<span id="cb380-9"><a href="preference-mapping.html#cb380-9" tabindex="-1"></a>                       <span class="at">data =</span> <span class="fu">crossing</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="fu">c</span>(<span class="fu">sqrt</span>(<span class="fl">0.5</span>), <span class="dv">1</span>)),</span>
<span id="cb380-10"><a href="preference-mapping.html#cb380-10" tabindex="-1"></a>                       <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb380-11"><a href="preference-mapping.html#cb380-11" tabindex="-1"></a>                       <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb380-12"><a href="preference-mapping.html#cb380-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> cluster)) <span class="sc">+</span> </span>
<span id="cb380-13"><a href="preference-mapping.html#cb380-13" tabindex="-1"></a>  <span class="co"># Here we are adding the correlations of the descriptor data, filtered so that</span></span>
<span id="cb380-14"><a href="preference-mapping.html#cb380-14" tabindex="-1"></a>  <span class="co"># the total variance explained in the 1st 2 dimensions is &gt; 0.75 (pretty</span></span>
<span id="cb380-15"><a href="preference-mapping.html#cb380-15" tabindex="-1"></a>  <span class="co"># arbitrarily)</span></span>
<span id="cb380-16"><a href="preference-mapping.html#cb380-16" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_label_repel</span>(<span class="at">data =</span> <span class="fu">cor</span>(pls_data<span class="sc">$</span>x, <span class="fu">column_to_rownames</span>(pls_scores, <span class="st">&quot;wine&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb380-17"><a href="preference-mapping.html#cb380-17" tabindex="-1"></a>                              <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;descriptor&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb380-18"><a href="preference-mapping.html#cb380-18" tabindex="-1"></a>                              <span class="fu">filter</span>(<span class="fu">sqrt</span>(<span class="st">`</span><span class="at">Comp 1</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="st">`</span><span class="at">Comp 2</span><span class="st">`</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">&gt;</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>),</span>
<span id="cb380-19"><a href="preference-mapping.html#cb380-19" tabindex="-1"></a>                            <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">label =</span> descriptor),</span>
<span id="cb380-20"><a href="preference-mapping.html#cb380-20" tabindex="-1"></a>                            <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb380-21"><a href="preference-mapping.html#cb380-21" tabindex="-1"></a><span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb380-22"><a href="preference-mapping.html#cb380-22" tabindex="-1"></a>  axis_labels <span class="sc">+</span> </span>
<span id="cb380-23"><a href="preference-mapping.html#cb380-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;PLS for external preference mapping&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-24"><a href="preference-mapping.html#cb380-24" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb380-25"><a href="preference-mapping.html#cb380-25" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="st">&quot;group&quot;</span>, <span class="at">end =</span> <span class="fl">0.8</span>) <span class="sc">+</span> </span>
<span id="cb380-26"><a href="preference-mapping.html#cb380-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="11-preference-mapping_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>We’re doing a lot in this plot, but hopefully the previous ones have prepared you! This shows us the same consumer plot as above, but we’ve clustered the consumers by the similarity between their liking scores, as we did in the internal preference mapping above. We could change this choice–perhaps cluster them based on their loadings in the 1st 2 dimensions of the PLS-R space–but I decided this was the way I wanted to go.</p>
<p>We see a similar pattern of separation of these groups as we did with the internal preference mapping, but now we have the ability to explain the data optimally: it appears the largest cluster (cluster 1) prefers wines that have proportionally higher ratings in attributes like <code>Oak</code>, <code>Burned</code>, and <code>Earthy</code>, while cluster 2 prefers <code>Sour</code> wines that are more characterized witht the various fruit flavors. As before, cluster 3 appears to be poorly represented in this space. We’d have to look into the further components to understand their preferences better (and it’s not clear to me whether or not we should, based on the <span class="math inline">\(PRESS\)</span> values).</p>
</div>
</div>
<div id="other-approaches" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Other approaches<a href="preference-mapping.html#other-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Beyond PLS-R and the models provided in <code>SensoMineR</code>, there are MANY models that can fit the goals of preference mapping: simultaneously explaining 2 data tables that have a variable linking them. One I have used more extensively in the past is Clustering around Latent Variables (CLV), which <a href="https://pdfs.semanticscholar.org/6f83/755c961579c891a63579a7a5a3bdf5df51e8.pdf">has its own <code>R</code> package and good tutorial here</a>. Hopefully going this extensively through PLS-R gives you enough of a background to tackle this approach (and others!) if you choose to use them.</p>
<p>Whatever approach you choose, though, I would recommend you err on the side of analytical simplicity: preference mapping is one of those areas in sensory evaluation in which apparently unending analytical sophistication is possible, but I have found that the gains in explanatory power or insight is limited. Remember that we are typically working with “small” data that is likely prone to random and sampling error, and so bringing huge power to bear on it is probably overkill. In addition, excessively complex methods are more likely to trip you up (it’s happened to me!) and to lose your audience, thus reducing your overall impact.</p>
</div>
<div id="principal-components-regression" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Principal Components Regression<a href="preference-mapping.html#principal-components-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To my understanding, Principal Components Regression (PCR) is a type of regression procedure that models a <em>univariate</em> outcome (a single <span class="math inline">\(\mathbf{y}\)</span> variable) based on the principal components (estimated through typical SVD) of a set of <span class="math inline">\(\mathbf{X}\)</span> predictors. So I am not entirely sure why HGH chose to apply PCR to the 2-table data (with a set of <span class="math inline">\(\mathbf{Y}\)</span> consumer liking outcomes), or even how it fit properly! PCR is not widely used in sensory evaluation, and so I am a little less familiar with it. The documentation for <code>?pls::pcr</code> is not at all detailed.</p>
<p>Inspecting the results that HGH got for PCR in the original <strong>R Opus</strong>, it appears that the results are almost <em>identical</em> to those of PLS-R with a rotation around the <span class="math inline">\(y\)</span>-axis. So I can’t imagine this is worth our time, especially for a method that is a) ill-defined in the documentation and b) seems to have been superseded by PLS methods in our field (and superseded by ridge/lasso regression elsewhere).</p>
</div>
<div id="packages-used-in-this-chapter-10" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Packages used in this chapter<a href="preference-mapping.html#packages-used-in-this-chapter-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="preference-mapping.html#cb381-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.3.1 (2023-06-16)
## Platform: aarch64-apple-darwin20 (64-bit)
## Running under: macOS Ventura 13.6.1
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## time zone: America/New_York
## tzcode source: internal
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] pls_2.8-2       patchwork_1.1.2 here_1.0.1      lubridate_1.9.2
##  [5] forcats_1.0.0   stringr_1.5.0   dplyr_1.1.2     purrr_1.0.1    
##  [9] readr_2.1.4     tidyr_1.3.0     tibble_3.2.1    ggplot2_3.4.3  
## [13] tidyverse_2.0.0
## 
## loaded via a namespace (and not attached):
##  [1] gridExtra_2.3        rlang_1.1.1          magrittr_2.0.3      
##  [4] compiler_4.3.1       vctrs_0.6.3          pkgconfig_2.0.3     
##  [7] crayon_1.5.2         fastmap_1.1.1        backports_1.4.1     
## [10] ellipsis_0.3.2       labeling_0.4.3       utf8_1.2.3          
## [13] promises_1.2.1       rmarkdown_2.23       tzdb_0.4.0          
## [16] shinyAce_0.4.2       bit_4.0.5            xfun_0.39           
## [19] cachem_1.0.8         jsonlite_1.8.7       flashClust_1.01-2   
## [22] highr_0.10           later_1.3.1          tweenr_2.0.2        
## [25] broom_1.0.5          parallel_4.3.1       cluster_2.1.4       
## [28] R6_2.5.1             bslib_0.5.1          stringi_1.7.12      
## [31] car_3.1-2            jquerylib_0.1.4      estimability_1.4.1  
## [34] Rcpp_1.0.11          bookdown_0.37        knitr_1.43          
## [37] base64enc_0.1-3      httpuv_1.6.11        timechange_0.2.0    
## [40] tidyselect_1.2.0     rstudioapi_0.15.0    abind_1.4-5         
## [43] yaml_2.3.7           viridis_0.6.4        miniUI_0.1.1.1      
## [46] ggedit_0.3.1         lattice_0.21-8       plyr_1.8.8          
## [49] shiny_1.7.5          withr_2.5.0          coda_0.19-4         
## [52] evaluate_0.21        polyclip_1.10-4      pillar_1.9.0        
## [55] ggpubr_0.6.0         carData_3.0-5        DT_0.28             
## [58] generics_0.1.3       vroom_1.6.3          rprojroot_2.0.3     
## [61] hms_1.1.3            munsell_0.5.0        scales_1.2.1        
## [64] xtable_1.8-4         leaps_3.1            glue_1.6.2          
## [67] emmeans_1.8.7        scatterplot3d_0.3-44 tools_4.3.1         
## [70] dendextend_1.17.1    ggsignif_0.6.4       mvtnorm_1.2-2       
## [73] grid_4.3.1           shinyBS_0.61.1       colorspace_2.1-0    
## [76] repr_1.1.6           ggforce_0.4.1        cli_3.6.1           
## [79] fansi_1.0.4          viridisLite_0.4.2    gtable_0.3.4        
## [82] rstatix_0.7.2        sass_0.4.7           digest_0.6.33       
## [85] ggrepel_0.9.3        FactoMineR_2.8       htmlwidgets_1.6.2   
## [88] skimr_2.1.5          farver_2.1.1         htmltools_0.5.6     
## [91] factoextra_1.0.7     lifecycle_1.0.3      multcompView_0.1-9  
## [94] mime_0.12            bit64_4.0.5          MASS_7.3-60</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-abdiPartial2013" class="csl-entry">
Abdi, Hervé, and Lynne J. Williams. 2013. <span>“Partial <span>Least Squares Methods</span>: <span>Partial Least Squares Correlation</span> and <span>Partial Least Square Regression</span>.”</span> In <em>Computational <span>Toxicology</span></em>, edited by Brad Reisfeld and Arthur N. Mayeno, 930:549–79. <span>Totowa, NJ</span>: <span>Humana Press</span>. <a href="https://doi.org/10.1007/978-1-62703-059-5_23">https://doi.org/10.1007/978-1-62703-059-5_23</a>.
</div>
<div id="ref-yenketCOMPARISON2011" class="csl-entry">
Yenket, Renoo, Edgar Chambers IV, and Koushik Adhikari. 2011. <span>“A <span>COMPARISON OF SEVEN PREFERENCE MAPPING TECHNIQUES USING FOUR SOFTWARE PROGRAMS</span>: <span>COMPARISON OF MAPPING TECHNIQUES</span>.”</span> <em>Journal of Sensory Studies</em> 26 (2): 135–50. <a href="https://doi.org/10.1111/j.1745-459X.2011.00330.x">https://doi.org/10.1111/j.1745-459X.2011.00330.x</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="correspondence-analysis-ca.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-factorial-analysis-mfa.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jlahne/r-opus-v2/edit/main/11-preference-mapping.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": "R-opus-v2.pdf",
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
